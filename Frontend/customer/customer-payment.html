<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - La Reserve</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body style="background: linear-gradient(135deg, var(--cream) 0%, white 100%);">
    <div class="container py-5">
        <!-- Header -->
        <div class="mb-4">
            <button class="btn btn-link text-dark-green p-0 mb-3" onclick="window.location.href='customer-booking.html'">
                <i class="bi bi-arrow-left"></i> Back to Booking
            </button>
            <h1 class="text-dark-green">Complete Your Payment</h1>
            <p class="text-muted">Review your booking and select payment method</p>
        </div>

        <div class="row g-4">
            <!-- Booking Summary -->
            <div class="col-lg-4">
                <div class="card shadow-sm sticky-top" style="top: 20px;">
                    <div class="card-body">
                        <h3 class="text-dark-green mb-4">Booking Summary</h3>
                        
                        <div class="border-bottom pb-2 mb-2">
                            <small class="text-muted">Booking Type</small>
                            <p class="mb-0 fw-bold text-capitalize" id="summaryType">-</p>
                        </div>
                        <div class="border-bottom pb-2 mb-2">
                            <small class="text-muted">Guests</small>
                            <p class="mb-0 fw-bold" id="summaryGuests">-</p>
                        </div>
                        <div class="border-bottom pb-2 mb-2">
                            <small class="text-muted">Date</small>
                            <p class="mb-0 fw-bold" id="summaryDate">-</p>
                        </div>
                        <div class="border-bottom pb-2 mb-2">
                            <small class="text-muted">Time</small>
                            <p class="mb-0 fw-bold" id="summaryTime">-</p>
                        </div>
                        <div class="border-bottom pb-2 mb-2">
                            <small class="text-muted">Name</small>
                            <p class="mb-0 fw-bold" id="summaryName">-</p>
                        </div>
                        <div class="border-bottom pb-2 mb-2">
                            <small class="text-muted">Mobile</small>
                            <p class="mb-0 fw-bold" id="summaryMobile">-</p>
                        </div>

                        <!-- Amount Breakdown -->
                        <div class="bg-beige rounded p-3 mt-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Base Amount</span>
                                <span id="baseAmount">₹0</span>
                            </div>
                            <div class="d-flex justify-content-between mb-3 pb-3 border-bottom">
                                <span>[This Base payment will be adjusted with your restaurant bill]</span>
                                <!-- <span id="gstAmount">₹0</span> -->
                            </div>
                            <div class="d-flex justify-content-between">
                                <strong>Total Amount</strong>
                                <strong class="text-warning fs-4" id="totalAmount">₹0</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payment Methods -->
            <div class="col-lg-8">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h3 class="text-dark-green mb-4">Select Payment Method</h3>

                        <!-- Payment Method Selection -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="payment-method" data-method="upi">
                                    <i class="bi bi-phone payment-icon"></i>
                                    <p class="fw-bold text-dark-green mb-1">UPI</p>
                                    <small class="text-muted">Google Pay, PhonePe, Paytm</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="payment-method" data-method="debit">
                                    <i class="bi bi-credit-card payment-icon"></i>
                                    <p class="fw-bold text-dark-green mb-1">Debit Card</p>
                                    <small class="text-muted">Visa, Mastercard, RuPay</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="payment-method" data-method="credit">
                                    <i class="bi bi-credit-card-2-front payment-icon"></i>
                                    <p class="fw-bold text-dark-green mb-1">Credit Card</p>
                                    <small class="text-muted">Visa, Mastercard, Amex</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="payment-method" data-method="netbanking">
                                    <i class="bi bi-bank payment-icon"></i>
                                    <p class="fw-bold text-dark-green mb-1">Net Banking</p>
                                    <small class="text-muted">All major banks</small>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Forms -->
                        <div id="paymentForms">
                            <!-- UPI Form -->
                            <div id="upiForm" style="display: none;">
                                <div class="mb-3">
                                    <label class="form-label">Enter UPI ID</label>
                                    <input type="text" class="form-control" placeholder="yourname@upi">
                                </div>
                                <div class="d-flex gap-2 mb-3">
                                    <button class="btn btn-outline-secondary flex-fill">GPay</button>
                                    <button class="btn btn-outline-secondary flex-fill">PhonePe</button>
                                    <button class="btn btn-outline-secondary flex-fill">Paytm</button>
                                </div>
                            </div>

                            <!-- Card Forms -->
                            <div id="cardForm" style="display: none;">
                                <div class="mb-3">
                                    <label class="form-label">Card Number</label>
                                    <input type="text" class="form-control" placeholder="1234 5678 9012 3456" maxlength="16">
                                </div>
                                <div class="row g-3 mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Expiry Date</label>
                                        <input type="text" class="form-control" placeholder="MM/YY">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">CVV</label>
                                        <input type="text" class="form-control" placeholder="123" maxlength="3">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Card Holder Name</label>
                                    <input type="text" class="form-control" placeholder="Name on card">
                                </div>
                            </div>

                            <!-- Net Banking Form -->
                            <div id="netbankingForm" style="display: none;">
                                <div class="mb-3">
                                    <label class="form-label">Select Your Bank</label>
                                    <select class="form-select">
                                        <option value="">Choose bank...</option>
                                        <option value="sbi">State Bank of India</option>
                                        <option value="hdfc">HDFC Bank</option>
                                        <option value="icici">ICICI Bank</option>
                                        <option value="axis">Axis Bank</option>
                                        <option value="pnb">Punjab National Bank</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Pay Button -->
                        <button id="payBtn" class="btn btn-gradient w-100 py-3" style="display: none;">
                            <span id="payBtnText">Pay Now</span>
                            <span id="payBtnSpinner" class="spinner-border spinner-border-sm ms-2" style="display: none;"></span>
                        </button>

                        <!-- Security Info -->
                        <div class="text-center mt-4 text-muted">
                            <i class="bi bi-shield-check"></i> Secure Payment
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let bookingData = null;
        let selectedMethod = '';

        $(document).ready(function() {
            if (localStorage.getItem('userType') !== 'customer') {
                window.location.href = '../index.html';
                return;
            }

            // Load booking data
            bookingData = JSON.parse(localStorage.getItem('currentBooking'));
            if (!bookingData) {
                window.location.href = 'customer-booking.html';
                return;
            }

            displayBookingSummary();

            // Payment method selection
            $('.payment-method').click(function() {
                $('.payment-method').removeClass('active');
                $(this).addClass('active');
                selectedMethod = $(this).data('method');
                
                // Hide all forms
                $('#upiForm, #cardForm, #netbankingForm').hide();
                
                // Show appropriate form
                if (selectedMethod === 'upi') {
                    $('#upiForm').show();
                } else if (selectedMethod === 'debit' || selectedMethod === 'credit') {
                    $('#cardForm').show();
                } else if (selectedMethod === 'netbanking') {
                    $('#netbankingForm').show();
                }
                
                $('#payBtn').show();
            });

            // Pay button
            $('#payBtn').click(function() {
                processPayment();
            });
        });

        function displayBookingSummary() {
            $('#summaryType').text(bookingData.bookingType);
            $('#summaryGuests').text(bookingData.seatingCapacity + ' people');
            $('#summaryDate').text(new Date(bookingData.date).toLocaleDateString());
            $('#summaryTime').text(bookingData.timeSlot);
            $('#summaryName').text(bookingData.customerName);
            $('#summaryMobile').text(bookingData.mobileNumber);

            // Calculate amount
            const baseRates = { date: 499, family: 999, meeting: 2499, party: 4999 };
            const baseAmount = baseRates[bookingData.bookingType] || 400;
            //const baseAmount = baseRate * parseInt(bookingData.seatingCapacity)
            //const gst = Math.round(baseAmount * 0.18);
            //const total = baseAmount + gst;

            $('#baseAmount').text('₹' + baseAmount);
            //$('#gstAmount').text('₹' + gst);
            $('#totalAmount').text('₹' + baseAmount);
        }

        function processPayment() {
            $('#payBtnText').text('Processing...');
            $('#payBtnSpinner').show();
            $('#payBtn').prop('disabled', true);

            // Simulate payment processing
            setTimeout(function() {
                // Save booking confirmation
                const confirmation = {
                    ...bookingData,
                    bookingId: 'BK' + Date.now(),
                    paymentMethod: selectedMethod,
                    confirmationDate: new Date().toISOString(),
                    status: 'confirmed'
                };

                // Add to bookings
                let bookings = JSON.parse(localStorage.getItem('bookings')) || [];
                bookings.push({
                    id: confirmation.bookingId,
                    customerName: confirmation.customerName,
                    tableCategory: confirmation.bookingType,
                    tableNumber: 'TBD',
                    date: confirmation.date,
                    time: confirmation.timeSlot,
                    status: 'confirmed'
                });
                localStorage.setItem('bookings', JSON.stringify(bookings));

                localStorage.setItem('lastBooking', JSON.stringify(confirmation));
                window.location.href = 'customer-confirmation.html';
            }, 2000);
        }
    </script>
</body>
</html>
